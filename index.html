<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Playground — Umem</title>
    <style>
      :root {
        --gap: 12px;
        --panel-bg: #0f172a;
        --editor-bg: #0b1220;
        --accent: #06b6d4;
      }
      html,
      body {
        height: 100%;
        margin: 0;
        font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI",
          Roboto, "Helvetica Neue", Arial;
      }
      body {
        display: flex;
        flex-direction: column;
        gap: var(--gap);
        background: #071025;
        color: #e6eef6;
        padding: 14px;
      }
      header {
        display: flex;
        align-items: center;
        gap: 16px;
      }
      header h1 {
        font-size: 16px;
        margin: 0;
      }
      .container {
        display: grid;
        grid-template-columns: 420px 1fr;
        gap: 12px;
        min-height: 60vh;
      }
      .left {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .tabs {
        display: flex;
        gap: 6px;
      }
      .tab {
        flex: 1;
        padding: 8px 10px;
        background: linear-gradient(180deg, #071226, #071a2c);
        border-radius: 8px;
        text-align: center;
        cursor: pointer;
        border: 1px solid rgba(255, 255, 255, 0.03);
      }
      .tab.active {
        box-shadow: 0 6px 18px rgba(2, 6, 23, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.06);
      }
      textarea {
        width: 100%;
        height: 220px;
        background: var(--editor-bg);
        color: #dbeafe;
        border: 1px solid rgba(255, 255, 255, 0.04);
        resize: vertical;
        padding: 12px;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono",
          monospace;
        font-size: 13px;
        border-radius: 8px;
      }
      .controls {
        display: flex;
        gap: 8px;
        align-items: center;
      }
      .btn {
        background: var(--accent);
        color: #042027;
        border: none;
        padding: 8px 12px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
      }
      .btn.secondary {
        background: transparent;
        color: #cfeefb;
        border: 1px solid rgba(255, 255, 255, 0.04);
      }
      .small {
        padding: 6px 8px;
        font-size: 13px;
      }
      .preview {
        background: #fff;
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid rgba(2, 6, 23, 0.5);
      }
      iframe {
        width: 100%;
        height: 100%;
        min-height: 420px;
        border: 0;
        display: block;
      }
      .meta {
        font-size: 13px;
        color: #9fb8c9;
      }
      .toolbar {
        display: flex;
        gap: 8px;
        align-items: center;
      }
      .right-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
      }
      .action-link {
        background: transparent;
        border: 0;
        color: #9fe6ff;
        text-decoration: underline;
        cursor: pointer;
      }
      footer {
        color: #97b6c8;
        font-size: 13px;
      }
      @media (max-width: 900px) {
        .container {
          grid-template-columns: 1fr;
        }
        .left textarea {
          height: 160px;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Playground — HTML · CSS · JS</h1>
      <div class="meta">
        Menjalankan kode front-end secara lokal (HTML/CSS/JS). Kode otomatis
        tersimpan di browser.
      </div>
    </header>

    <div class="container">
      <div class="left">
        <div class="tabs">
          <div id="tab-html" class="tab active">HTML</div>
          <div id="tab-css" class="tab">CSS</div>
          <div id="tab-js" class="tab">JS</div>
        </div>

        <div id="editor-html" class="editor-panel">
          <textarea
            id="html"
            spellcheck="false"
            placeholder="Tulis HTML di sini &lt;!-- contoh: <h1>Hello</h1> --&gt;"
          ></textarea>
        </div>

        <div id="editor-css" class="editor-panel" style="display: none">
          <textarea
            id="css"
            spellcheck="false"
            placeholder="Tulis CSS di sini"
          ></textarea>
        </div>

        <div id="editor-js" class="editor-panel" style="display: none">
          <textarea
            id="js"
            spellcheck="false"
            placeholder="Tulis JavaScript di sini"
          ></textarea>
        </div>

        <div style="display: flex; gap: 8px; align-items: center">
          <div class="controls">
            <button id="run" class="btn">Run</button>
            <button id="autoToggle" class="btn secondary small">
              Auto: Off
            </button>
            <button id="openNew" class="btn secondary small">
              Open in new tab
            </button>
            <button id="download" class="btn secondary small">
              Download .html
            </button>
          </div>
        </div>

        <div class="meta">
          Tip: tekan <strong>Ctrl/Cmd + Enter</strong> untuk menjalankan. Kode
          disimpan otomatis di browser.
        </div>
      </div>

      <div>
        <div class="right-top">
          <div style="display: flex; gap: 8px; align-items: center">
            <div class="meta">Preview</div>
          </div>
          <div class="toolbar">
            <button id="clearStorage" class="btn secondary small">
              Clear saved
            </button>
          </div>
        </div>

        <div class="preview" style="margin-top: 8px; min-height: 420px">
          <iframe
            id="preview"
            sandbox="allow-scripts allow-forms allow-modals"
          ></iframe>
        </div>
      </div>
    </div>

    <footer style="margin-top: 8px">
      Built for you — ketik kode lalu klik Run.
    </footer>

    <script>
      // Simple single-file playground logic
      const el = (id) => document.getElementById(id);
      const htmlEl = el("html"),
        cssEl = el("css"),
        jsEl = el("js"),
        preview = el("preview");
      const RUN_KEY = "playground_saved_v1";
      let auto = false;

      // sample starter
      const defaultHTML = `<!doctype html>\n<html>\n  <body>\n    <h1>Hello from Playground</h1>\n    <div id=app></div>\n  </body>\n</html>`;
      const defaultCSS = `body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:16px}h1{color:#0b74a6}`;
      const defaultJS = `document.getElementById('app').innerText = 'Ditulis oleh JS';`;

      function loadSaved() {
        try {
          const raw = localStorage.getItem(RUN_KEY);
          if (!raw) return false;
          const obj = JSON.parse(raw);
          htmlEl.value = obj.html || defaultHTML;
          cssEl.value = obj.css || defaultCSS;
          jsEl.value = obj.js || defaultJS;
          return true;
        } catch (e) {
          console.warn(e);
          return false;
        }
      }

      function save() {
        const obj = {
          html: htmlEl.value,
          css: cssEl.value,
          js: jsEl.value,
          updated: Date.now(),
        };
        localStorage.setItem(RUN_KEY, JSON.stringify(obj));
      }

      function buildSrcDoc() {
        const head = `<style>${cssEl.value}\n</style>`;
        const body =
          htmlEl.value +
          `\n<script>\ntry{\n${jsEl.value}\n}catch(e){document.body.appendChild(Object.assign(document.createElement('pre'),{textContent:'JS error: '+e.message}))}\n<\/script>`;
        return head + body;
      }

      function run() {
        const src = buildSrcDoc();
        preview.srcdoc = src;
        save();
      }

      // UI wiring
      el("run").addEventListener("click", run);
      el("openNew").addEventListener("click", () => {
        const src = buildSrcDoc();
        const w = window.open();
        w.document.open();
        w.document.write(
          "<!doctype html><html><head>" +
            '<meta charset="utf-8">' +
            '<meta name="viewport" content="width=device-width,initial-scale=1">' +
            "<style>" +
            cssEl.value +
            "</style></head>" +
            htmlEl.value +
            "<script>" +
            jsEl.value +
            "<\/script></html>"
        );
        w.document.close();
      });

      el("download").addEventListener("click", () => {
        const full =
          '<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><style>' +
          cssEl.value +
          "</style></head>" +
          htmlEl.value +
          "<script>" +
          jsEl.value +
          "<\/script></html>";
        const blob = new Blob([full], { type: "text/html" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "playground.html";
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      });

      el("clearStorage").addEventListener("click", () => {
        localStorage.removeItem(RUN_KEY);
        alert("Saved code cleared. Halaman akan kembali ke kode default.");
        htmlEl.value = defaultHTML;
        cssEl.value = defaultCSS;
        jsEl.value = defaultJS;
        run();
      });

      // tabs
      ["html", "css", "js"].forEach((k) => {
        el("tab-" + k).addEventListener("click", () => {
          document
            .querySelectorAll(".tab")
            .forEach((t) => t.classList.remove("active"));
          document.getElementById("tab-" + k).classList.add("active");
          document
            .querySelectorAll(".editor-panel")
            .forEach((p) => (p.style.display = "none"));
          document.getElementById("editor-" + k).style.display = "";
        });
      });

      // keyboard shortcut
      window.addEventListener("keydown", (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
          e.preventDefault();
          run();
        }
      });

      // auto-run
      el("autoToggle").addEventListener("click", () => {
        auto = !auto;
        el("autoToggle").textContent = "Auto: " + (auto ? "On" : "Off");
      });

      [htmlEl, cssEl, jsEl].forEach((inp) => {
        inp.addEventListener("input", () => {
          if (auto) run();
          // debounce save
          if (window._saveTimeout) clearTimeout(window._saveTimeout);
          window._saveTimeout = setTimeout(save, 600);
        });
      });

      // initialize
      if (!loadSaved()) {
        htmlEl.value = defaultHTML;
        cssEl.value = defaultCSS;
        jsEl.value = defaultJS;
      }
      run();
    </script>
  </body>
</html>
